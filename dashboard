<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2AO Selfie ‚Äî Dashboard</title>
<style>
:root{--bg:#0a0e17;--sf:#111827;--sf2:#1e293b;--bd:#1e3a5f;--tx:#e2e8f0;--mt:#64748b;--gn:#10b981;--or:#f59e0b;--rd:#ef4444;--bl:#3b82f6;--ac:#00E676}
*{box-sizing:border-box;margin:0;padding:0}body{background:var(--bg);color:var(--tx);font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh}
#login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh}
.login-box{background:var(--sf);border:1px solid var(--bd);border-radius:16px;padding:40px;width:360px;text-align:center}
.login-box h1{font-size:28px;margin-bottom:8px;background:linear-gradient(135deg,#00C853,#00E676,#1DE9B6);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-box p{color:var(--mt);margin-bottom:24px;font-size:14px}
.login-box input{width:100%;padding:12px 16px;background:var(--bg);border:1px solid var(--bd);border-radius:10px;color:var(--tx);font-size:14px;margin-bottom:12px;outline:none}
.login-box input:focus{border-color:var(--ac)}
.login-box button{width:100%;padding:12px;background:linear-gradient(135deg,#00C853,#00E676);color:#000;border:none;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer}
#login-error{color:var(--rd);font-size:13px;margin-top:8px;display:none}
#app{display:none}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;background:var(--sf);border-bottom:1px solid var(--bd)}
.topbar h1{font-size:20px;display:flex;align-items:center;gap:10px}
.logo{width:32px;height:32px;background:linear-gradient(135deg,#00C853,#00E676);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:13px;color:#000}
.topbar-actions{display:flex;gap:10px;align-items:center}
.cnt{background:var(--ac);color:#000;padding:2px 10px;border-radius:12px;font-weight:700;font-size:13px}
.toolbar{display:flex;gap:10px;padding:16px 24px;flex-wrap:wrap;align-items:center}
.btn{padding:8px 16px;border-radius:8px;border:1px solid var(--bd);background:var(--sf2);color:var(--tx);font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:.2s}
.btn:hover{background:var(--bd)}.btn-g{background:var(--gn);color:#fff;border-color:var(--gn)}.btn-r{background:var(--rd);color:#fff;border-color:var(--rd)}.btn-b{background:var(--bl);color:#fff;border-color:var(--bl)}
.search{flex:1;min-width:200px;padding:8px 14px;background:var(--bg);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:13px;outline:none}
.search:focus{border-color:var(--ac)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;padding:0 24px 24px}
.card{background:var(--sf);border:1px solid var(--bd);border-radius:14px;padding:16px;position:relative;transition:.2s}
.card:hover{border-color:var(--ac);transform:translateY(-2px)}
.card-ph{width:64px;height:64px;border-radius:50%;margin:0 auto 12px;background:var(--sf2);display:flex;align-items:center;justify-content:center;font-size:28px;overflow:hidden;border:2px solid var(--bd)}
.card-ph img{width:100%;height:100%;object-fit:cover}
.card-info{text-align:center}
.card-info .nm{font-weight:700;font-size:14px;margin-bottom:4px}
.card-info .dt{font-size:12px;color:var(--mt);margin-bottom:2px}
.card-lk{display:flex;align-items:center;gap:4px;margin-top:8px;justify-content:center}
.card-lk span{font-size:11px;color:var(--mt);max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cpb{background:none;border:none;color:var(--bl);cursor:pointer;font-size:14px;padding:2px}
.badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;margin-top:8px}
.b-ok{background:rgba(16,185,129,.15);color:var(--gn)}.b-pn{background:rgba(245,158,11,.15);color:var(--or)}.b-er{background:rgba(239,68,68,.15);color:var(--rd)}
.card-act{display:flex;gap:6px;margin-top:10px;justify-content:center}.card-act .btn{padding:5px 10px;font-size:11px}
.card-ck{position:absolute;top:10px;right:10px}
.card-ck input{width:16px;height:16px;cursor:pointer;accent-color:var(--ac)}
.modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:10000;display:none;align-items:center;justify-content:center}
.modal-ov.show{display:flex}
.modal{background:var(--sf);border:1px solid var(--bd);border-radius:16px;padding:28px;width:400px;max-width:95vw}
.modal h2{font-size:18px;margin-bottom:16px}
.modal label{display:block;font-size:13px;font-weight:600;color:var(--mt);margin:12px 0 4px}
.modal input,.modal select{width:100%;padding:10px 14px;background:var(--bg);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:14px;outline:none}
.modal input:focus{border-color:var(--ac)}
.modal-act{display:flex;gap:10px;margin-top:20px;justify-content:flex-end}
.toast{position:fixed;bottom:24px;right:24px;background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:14px 20px;z-index:20000;display:flex;align-items:center;gap:10px;font-size:14px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.4);transform:translateY(100px);opacity:0;transition:.3s}
.toast.show{transform:translateY(0);opacity:1}
.t-ok{border-color:var(--gn)}.t-info{border-color:var(--bl)}.t-err{border-color:var(--rd)}
@media(max-width:600px){.grid{grid-template-columns:1fr 1fr;gap:10px;padding:0 12px 12px}.toolbar{padding:12px}}
</style></head><body>

<div id="login-screen">
<div class="login-box">
<h1>2AO SELFIE</h1><p>Syst√®me de gestion Liveness</p>
<input type="text" id="loginUser" placeholder="Username" autofocus>
<input type="password" id="loginPass" placeholder="Password">
<button onclick="doLogin()">üîê Connexion</button>
<div id="login-error">Identifiants incorrects</div>
</div></div>

<div id="app">
<div class="topbar">
<h1><div class="logo">2A</div> 2AO Selfie</h1>
<div class="topbar-actions">
<span>Total Livenesses:</span><span class="cnt" id="totalCount">0</span>
<button class="btn" onclick="refresh()" title="Refresh">üîÑ</button>
<button class="btn btn-r" onclick="doLogout()" style="font-size:12px">Logout</button>
</div></div>

<div class="toolbar">
<button class="btn btn-g" onclick="showAdd()">‚ûï New Liveness</button>
<button class="btn btn-b" onclick="checkAll()">‚úÖ Check All</button>
<button class="btn btn-r" onclick="delSel()">üóëÔ∏è Delete</button>
<input class="search" type="text" id="searchInput" placeholder="üîç Search..." oninput="filter()">
</div>
<div class="grid" id="grid"></div>
</div>

<div class="modal-ov" id="addModal">
<div class="modal">
<h2>‚ûï Add Selfie Account</h2>
<label>Select a profile to associate with the liveness check.</label>
<select id="mProfile"><option value="">‚Äî Select Profile ‚Äî</option></select>
<label>User Name *</label><input type="text" id="mUser" placeholder="Username">
<label>Password *</label><input type="text" id="mPass" value="123">
<div class="modal-act">
<button class="btn btn-g" onclick="saveAcc()">üíæ Save</button>
<button class="btn btn-r" onclick="closeAdd()">Cancel</button>
</div></div></div>

<div class="toast" id="toast"></div>

<script>
var TOKEN='',SERVER=location.origin,ALL=[];

function doLogin(){
var u=document.getElementById('loginUser').value.trim(),p=document.getElementById('loginPass').value;
fetch(SERVER+'/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})})
.then(r=>r.json()).then(d=>{if(d.ok){TOKEN=d.token;localStorage.setItem('2ao_t',TOKEN);showApp();}else document.getElementById('login-error').style.display='block';})
.catch(()=>document.getElementById('login-error').style.display='block');
}
function doLogout(){TOKEN='';localStorage.removeItem('2ao_t');document.getElementById('app').style.display='none';document.getElementById('login-screen').style.display='flex';}
function showApp(){document.getElementById('login-screen').style.display='none';document.getElementById('app').style.display='block';refresh();}

function api(m,p,b){var o={method:m,headers:{'Content-Type':'application/json','X-Auth-Token':TOKEN}};if(b)o.body=JSON.stringify(b);return fetch(SERVER+p,o).then(r=>{if(r.status===401){doLogout();throw new Error('Unauth');}return r.json();});}

function refresh(){api('GET','/api/accounts').then(d=>{if(d.ok){ALL=d.accounts;document.getElementById('totalCount').textContent=d.total;render(ALL);}});}

function render(list){
var g=document.getElementById('grid');g.innerHTML='';
list.forEach(a=>{
var sc=a.status==='accepted'?'b-ok':a.status==='error'?'b-er':'b-pn';
var ph=a.photo?'<img src="'+a.photo+'">':'üë§';
var lk='';
if(a.selfieLink){lk='<div class="card-lk"><span title="'+a.selfieLink+'">COPY Link:</span><button class="cpb" onclick="copyLk(\''+a.username+'\')" title="Copy">üìã</button></div>';}
else{lk='<div class="card-lk"><span>COPY Link:</span><button class="cpb" onclick="genLk(\''+a.username+'\')" title="Generate">üîó</button></div>';}
g.innerHTML+='<div class="card" data-u="'+a.username+'">'+
'<div class="card-ck"><input type="checkbox" class="scb" data-u="'+a.username+'"></div>'+
'<div class="card-ph">'+ph+'</div>'+
'<div class="card-info">'+
'<div class="nm">Username: '+a.username+'</div>'+
'<div class="dt">Password: '+a.password+'</div>'+lk+
'<div class="badge '+sc+'">'+a.status+'</div>'+
'</div>'+
'<div class="card-act">'+
'<button class="btn btn-b" onclick="chk1(\''+a.username+'\')">üîç Check</button>'+
'<button class="btn btn-r" onclick="del1(\''+a.username+'\')">üóëÔ∏è</button>'+
'</div></div>';
});
}

function showAdd(){document.getElementById('addModal').classList.add('show');document.getElementById('mUser').value='';document.getElementById('mPass').value='123';document.getElementById('mUser').focus();}
function closeAdd(){document.getElementById('addModal').classList.remove('show');}

function saveAcc(){
var u=document.getElementById('mUser').value.trim(),p=document.getElementById('mPass').value.trim(),pr=document.getElementById('mProfile').value;
if(!u||!p){toast('Username et password requis','err');return;}
api('POST','/api/accounts',{username:u,password:p,profile:pr}).then(d=>{if(d.ok){toast('‚úÖ Compte '+u+' cr√©√©','ok');closeAdd();refresh();}else toast('‚ùå '+(d.error||'Erreur'),'err');});
}

function genLk(u){
api('POST','/api/accounts/'+u+'/generate-link').then(d=>{
if(d.ok){navigator.clipboard.writeText(d.selfieLink).then(()=>toast('üîó Lien copi√©!','info')).catch(()=>toast('üîó '+d.selfieLink,'info'));refresh();}
});
}

function copyLk(u){var a=ALL.find(x=>x.username===u);if(a&&a.selfieLink)navigator.clipboard.writeText(a.selfieLink).then(()=>toast('üìã Lien copi√©!','ok'));}
function chk1(u){api('GET','/api/selfie-result/'+u).then(d=>{if(d.ok){toast(u+': '+(d.status==='accepted'?'‚úÖ Accepted':'‚è≥ Pending'),d.status==='accepted'?'ok':'info');refresh();}});}
function checkAll(){api('POST','/api/accounts/check-all').then(d=>{if(d.ok){toast('‚úÖ V√©rification termin√©e','ok');refresh();}});}
function del1(u){if(!confirm('Supprimer '+u+'?'))return;api('DELETE','/api/accounts/'+u).then(()=>{toast('üóëÔ∏è Supprim√©','ok');refresh();});}
function delSel(){
var cbs=document.querySelectorAll('.scb:checked'),us=Array.from(cbs).map(c=>c.dataset.u);
if(!us.length){toast('S√©lectionnez des comptes','err');return;}
if(!confirm('Supprimer '+us.length+' comptes?'))return;
api('POST','/api/accounts/bulk-delete',{usernames:us}).then(()=>{toast('üóëÔ∏è '+us.length+' supprim√©s','ok');refresh();});
}
function filter(){var q=document.getElementById('searchInput').value.toLowerCase();render(ALL.filter(a=>a.username.toLowerCase().includes(q)));}
function toast(m,t){var e=document.getElementById('toast');e.className='toast t-'+(t||'info')+' show';e.innerHTML=m;setTimeout(()=>e.classList.remove('show'),3500);}

document.getElementById('loginPass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
document.getElementById('loginUser').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('loginPass').focus();});
var st=localStorage.getItem('2ao_t');
if(st){TOKEN=st;api('GET','/api/accounts').then(d=>{if(d.ok)showApp();else doLogout();}).catch(()=>doLogout());}
</script></body></html>
